/* global ethers */
/* eslint prefer-const: "off" */
import { Contract, Wallet, JsonRpcProvider } from 'ethers';

const GATEWAY_ABI = [{"inputs":[],"name":"appliedTopDownNonce","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bottomUpCheckPeriod","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"e","type":"uint64"}],"name":"bottomUpCheckpoint","outputs":[{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetID","type":"tuple"},{"internalType":"uint64","name":"blockHeight","type":"uint64"},{"internalType":"bytes32","name":"blockHash","type":"bytes32"},{"internalType":"uint64","name":"nextConfigurationNumber","type":"uint64"},{"internalType":"bytes32","name":"crossMessagesHash","type":"bytes32"}],"internalType":"structBottomUpCheckpoint","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"e","type":"uint64"}],"name":"bottomUpMessages","outputs":[{"components":[{"components":[{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"components":[{"internalType":"uint8","name":"addrType","type":"uint8"},{"internalType":"bytes","name":"payload","type":"bytes"}],"internalType":"structFvmAddress","name":"rawAddress","type":"tuple"}],"internalType":"structIPCAddress","name":"from","type":"tuple"},{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"components":[{"internalType":"uint8","name":"addrType","type":"uint8"},{"internalType":"bytes","name":"payload","type":"bytes"}],"internalType":"structFvmAddress","name":"rawAddress","type":"tuple"}],"internalType":"structIPCAddress","name":"to","type":"tuple"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint64","name":"nonce","type":"uint64"},{"internalType":"bytes4","name":"method","type":"bytes4"},{"internalType":"bytes","name":"params","type":"bytes"},{"internalType":"uint256","name":"fee","type":"uint256"}],"internalType":"structStorableMsg","name":"message","type":"tuple"},{"internalType":"bool","name":"wrapped","type":"bool"}],"internalType":"structCrossMsg[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bottomUpNonce","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"crossMsgFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"}],"name":"getAppliedTopDownNonce","outputs":[{"internalType":"bool","name":"","type":"bool"},{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getBottomUpRetentionHeight","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"h","type":"uint64"}],"name":"getCheckpointCurrentWeight","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"h","type":"uint64"}],"name":"getCheckpointInfo","outputs":[{"components":[{"internalType":"bytes32","name":"hash","type":"bytes32"},{"internalType":"bytes32","name":"rootHash","type":"bytes32"},{"internalType":"uint256","name":"threshold","type":"uint256"},{"internalType":"uint256","name":"currentWeight","type":"uint256"},{"internalType":"bool","name":"reached","type":"bool"}],"internalType":"structCheckpointInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getCurrentConfigurationNumber","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getCurrentMembership","outputs":[{"components":[{"components":[{"internalType":"uint256","name":"weight","type":"uint256"},{"internalType":"address","name":"addr","type":"address"},{"internalType":"bytes","name":"metadata","type":"bytes"}],"internalType":"structValidator[]","name":"validators","type":"tuple[]"},{"internalType":"uint64","name":"configurationNumber","type":"uint64"}],"internalType":"structMembership","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getIncompleteCheckpointHeights","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getIncompleteCheckpoints","outputs":[{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetID","type":"tuple"},{"internalType":"uint64","name":"blockHeight","type":"uint64"},{"internalType":"bytes32","name":"blockHash","type":"bytes32"},{"internalType":"uint64","name":"nextConfigurationNumber","type":"uint64"},{"internalType":"bytes32","name":"crossMessagesHash","type":"bytes32"}],"internalType":"structBottomUpCheckpoint[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLastConfigurationNumber","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLastMembership","outputs":[{"components":[{"components":[{"internalType":"uint256","name":"weight","type":"uint256"},{"internalType":"address","name":"addr","type":"address"},{"internalType":"bytes","name":"metadata","type":"bytes"}],"internalType":"structValidator[]","name":"validators","type":"tuple[]"},{"internalType":"uint64","name":"configurationNumber","type":"uint64"}],"internalType":"structMembership","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLatestParentFinality","outputs":[{"components":[{"internalType":"uint256","name":"height","type":"uint256"},{"internalType":"bytes32","name":"blockHash","type":"bytes32"}],"internalType":"structParentFinality","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getNetworkName","outputs":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"blockNumber","type":"uint256"}],"name":"getParentFinality","outputs":[{"components":[{"internalType":"uint256","name":"height","type":"uint256"},{"internalType":"bytes32","name":"blockHash","type":"bytes32"}],"internalType":"structParentFinality","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"totalWeight","type":"uint256"}],"name":"getQuorumThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"h","type":"uint64"}],"name":"getSignatureBundle","outputs":[{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetID","type":"tuple"},{"internalType":"uint64","name":"blockHeight","type":"uint64"},{"internalType":"bytes32","name":"blockHash","type":"bytes32"},{"internalType":"uint64","name":"nextConfigurationNumber","type":"uint64"},{"internalType":"bytes32","name":"crossMessagesHash","type":"bytes32"}],"internalType":"structBottomUpCheckpoint","name":"ch","type":"tuple"},{"components":[{"internalType":"bytes32","name":"hash","type":"bytes32"},{"internalType":"bytes32","name":"rootHash","type":"bytes32"},{"internalType":"uint256","name":"threshold","type":"uint256"},{"internalType":"uint256","name":"currentWeight","type":"uint256"},{"internalType":"bool","name":"reached","type":"bool"}],"internalType":"structCheckpointInfo","name":"info","type":"tuple"},{"internalType":"address[]","name":"signatories","type":"address[]"},{"internalType":"bytes[]","name":"signatures","type":"bytes[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"}],"name":"getSubnet","outputs":[{"internalType":"bool","name":"","type":"bool"},{"components":[{"internalType":"uint256","name":"stake","type":"uint256"},{"internalType":"uint256","name":"genesisEpoch","type":"uint256"},{"internalType":"uint256","name":"circSupply","type":"uint256"},{"internalType":"uint64","name":"topDownNonce","type":"uint64"},{"internalType":"uint64","name":"appliedBottomUpNonce","type":"uint64"},{"internalType":"enumStatus","name":"status","type":"uint8"},{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"id","type":"tuple"}],"internalType":"structSubnet","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"}],"name":"getSubnetTopDownMsgsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"internalType":"uint256","name":"blockNumber","type":"uint256"}],"name":"getTopDownMsgs","outputs":[{"components":[{"components":[{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"components":[{"internalType":"uint8","name":"addrType","type":"uint8"},{"internalType":"bytes","name":"payload","type":"bytes"}],"internalType":"structFvmAddress","name":"rawAddress","type":"tuple"}],"internalType":"structIPCAddress","name":"from","type":"tuple"},{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"components":[{"internalType":"uint8","name":"addrType","type":"uint8"},{"internalType":"bytes","name":"payload","type":"bytes"}],"internalType":"structFvmAddress","name":"rawAddress","type":"tuple"}],"internalType":"structIPCAddress","name":"to","type":"tuple"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint64","name":"nonce","type":"uint64"},{"internalType":"bytes4","name":"method","type":"bytes4"},{"internalType":"bytes","name":"params","type":"bytes"},{"internalType":"uint256","name":"fee","type":"uint256"}],"internalType":"structStorableMsg","name":"message","type":"tuple"},{"internalType":"bool","name":"wrapped","type":"bool"}],"internalType":"structCrossMsg[]","name":"msgs","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"listSubnets","outputs":[{"components":[{"internalType":"uint256","name":"stake","type":"uint256"},{"internalType":"uint256","name":"genesisEpoch","type":"uint256"},{"internalType":"uint256","name":"circSupply","type":"uint256"},{"internalType":"uint64","name":"topDownNonce","type":"uint64"},{"internalType":"uint64","name":"appliedBottomUpNonce","type":"uint64"},{"internalType":"enumStatus","name":"status","type":"uint8"},{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"id","type":"tuple"}],"internalType":"structSubnet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"majorityPercentage","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minStake","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"postbox","outputs":[{"components":[{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"components":[{"internalType":"uint8","name":"addrType","type":"uint8"},{"internalType":"bytes","name":"payload","type":"bytes"}],"internalType":"structFvmAddress","name":"rawAddress","type":"tuple"}],"internalType":"structIPCAddress","name":"from","type":"tuple"},{"components":[{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"subnetId","type":"tuple"},{"components":[{"internalType":"uint8","name":"addrType","type":"uint8"},{"internalType":"bytes","name":"payload","type":"bytes"}],"internalType":"structFvmAddress","name":"rawAddress","type":"tuple"}],"internalType":"structIPCAddress","name":"to","type":"tuple"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint64","name":"nonce","type":"uint64"},{"internalType":"bytes4","name":"method","type":"bytes4"},{"internalType":"bytes","name":"params","type":"bytes"},{"internalType":"uint256","name":"fee","type":"uint256"}],"internalType":"structStorableMsg","name":"storableMsg","type":"tuple"},{"internalType":"bool","name":"wrapped","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"h","type":"bytes32"}],"name":"subnets","outputs":[{"components":[{"internalType":"uint256","name":"stake","type":"uint256"},{"internalType":"uint256","name":"genesisEpoch","type":"uint256"},{"internalType":"uint256","name":"circSupply","type":"uint256"},{"internalType":"uint64","name":"topDownNonce","type":"uint64"},{"internalType":"uint64","name":"appliedBottomUpNonce","type":"uint64"},{"internalType":"enumStatus","name":"status","type":"uint8"},{"components":[{"internalType":"uint64","name":"root","type":"uint64"},{"internalType":"address[]","name":"route","type":"address[]"}],"internalType":"structSubnetID","name":"id","type":"tuple"}],"internalType":"structSubnet","name":"subnet","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSubnets","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"}];
const PRIVATE_KEY = "0x0123456789012345678901234567890123456789012345678901234567890123";
const RPC_URL = "https://api.calibration.node.glif.io/rpc/v1";
const GATEWAY_ADDRESS = '0x5Be26735Ab7A70B057e76e31953d8811f95b05AC';

async function connectGateway(gatewayAddress: string, abi: any[], privateKey: string, rpcUrl: string) {
    let provider = new JsonRpcProvider(rpcUrl);
    let signer = new Wallet(privateKey, provider);

    console.log("block number: ", await provider.getBlockNumber());

    const contract = new Contract(gatewayAddress, abi, signer);

    const parent = { route: [], root: "r314159" };
    const subnetId = { route: [], root: "r314159" };

    console.log("subnets: ", await contract.listSubnets());
    // console.log("parent finality", await contract.getParentFinality(1000));
    // console.log("subnet: ", await contract.getSubnet({ route: [], root: "r314159" }));
    // console.log("top down messages: ", await contract.getTopDownMsgs({ route: [], root: "r314159" }, 10));
}

connectGateway(GATEWAY_ADDRESS, GATEWAY_ABI, PRIVATE_KEY, RPC_URL);
